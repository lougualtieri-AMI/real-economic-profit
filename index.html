<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Real Economic Profit Analyzer</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0b0f19;
    --surface: #111827;
    --surface2: #1a2235;
    --border: #1e293b;
    --border-focus: #f59e0b;
    --text: #e2e8f0;
    --text-dim: #64748b;
    --text-muted: #475569;
    --accent: #f59e0b;
    --accent-glow: rgba(245, 158, 11, 0.15);
    --green: #22c55e;
    --green-dim: rgba(34, 197, 94, 0.12);
    --red: #ef4444;
    --red-dim: rgba(239, 68, 68, 0.12);
    --amber: #f59e0b;
    --cyan: #06b6d4;
    --purple: #a78bfa;
    --blue: #3b82f6;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }

  .app-header {
    padding: 24px 32px 18px;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(180deg, rgba(245,158,11,0.04) 0%, transparent 100%);
  }
  .app-header h1 { font-family: 'JetBrains Mono', monospace; font-size: 20px; font-weight: 600; color: var(--text); }
  .app-header h1 span { color: var(--accent); }
  .app-header p { font-size: 13px; color: var(--text-dim); margin-top: 4px; }

  .container { max-width: 1400px; margin: 0 auto; padding: 24px 32px 60px; }
  .grid-layout { display: grid; grid-template-columns: 380px 1fr; gap: 24px; align-items: start; }

  /* INPUT PANEL */
  .input-panel { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 24px; position: sticky; top: 20px; max-height: 95vh; overflow-y: auto; }
  .panel-title { font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--text-dim); margin-bottom: 16px; }
  .section-head { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.2px; color: var(--accent); margin-bottom: 10px; margin-top: 6px; padding-bottom: 6px; border-bottom: 1px solid rgba(245,158,11,0.2); }
  .input-group { margin-bottom: 10px; }
  .input-group label { display: block; font-size: 11px; font-weight: 500; color: var(--text-dim); margin-bottom: 4px; font-family: 'JetBrains Mono', monospace; }
  .input-group input { width: 100%; background: var(--bg); border: 1px solid var(--border); border-radius: 7px; padding: 9px 11px; font-family: 'JetBrains Mono', monospace; font-size: 13px; color: var(--text); outline: none; transition: border-color 0.2s; }
  .input-group input:focus { border-color: var(--border-focus); box-shadow: 0 0 0 2px var(--accent-glow); }
  .input-group input::placeholder { color: var(--text-muted); }
  .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .input-hint { font-size: 10px; color: var(--text-muted); margin-top: 2px; font-style: italic; }
  .divider { height: 1px; background: var(--border); margin: 16px 0; }

  .btn-run { width: 100%; padding: 12px; background: var(--accent); border: none; border-radius: 8px; color: #000; font-family: 'DM Sans', sans-serif; font-size: 14px; font-weight: 700; cursor: pointer; transition: all 0.2s; margin-top: 10px; letter-spacing: 0.3px; }
  .btn-run:hover { background: #d97706; transform: translateY(-1px); box-shadow: 0 4px 16px rgba(245,158,11,0.3); }
  .btn-clear { width: 100%; padding: 8px; background: transparent; border: 1px solid var(--border); border-radius: 8px; color: var(--text-dim); font-family: 'DM Sans', sans-serif; font-size: 12px; cursor: pointer; margin-top: 8px; }
  .btn-clear:hover { border-color: var(--red); color: var(--red); }

  /* RESULTS */
  .results-panel { display: flex; flex-direction: column; gap: 20px; }
  .card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 24px; }
  .card-title { font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--text-dim); margin-bottom: 16px; }

  .metrics-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }
  .metric-box { background: var(--bg); border: 1px solid var(--border); border-radius: 10px; padding: 16px; text-align: center; }
  .metric-box .label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; color: var(--text-dim); margin-bottom: 6px; }
  .metric-box .value { font-family: 'JetBrains Mono', monospace; font-size: 22px; font-weight: 600; }
  .metric-box .sub { font-size: 10px; color: var(--text-dim); margin-top: 4px; font-family: 'JetBrains Mono', monospace; }

  .color-green { color: var(--green); }
  .color-red { color: var(--red); }
  .color-amber { color: var(--amber); }
  .color-cyan { color: var(--cyan); }
  .color-accent { color: var(--accent); }
  .color-purple { color: var(--purple); }
  .color-blue { color: var(--blue); }

  /* WATERFALL */
  .waterfall { display: flex; align-items: flex-end; gap: 4px; height: 180px; margin-top: 12px; padding: 0 8px; }
  .wf-col { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; height: 100%; }
  .wf-val { font-family: 'JetBrains Mono', monospace; font-size: 9px; color: var(--text-dim); margin-bottom: 4px; white-space: nowrap; }
  .wf-bar { width: 80%; max-width: 60px; border-radius: 3px 3px 0 0; min-height: 2px; }
  .wf-label { font-family: 'JetBrains Mono', monospace; font-size: 8px; color: var(--text-muted); margin-top: 5px; text-align: center; line-height: 1.2; }

  /* BREAKDOWN TABLE */
  .breakdown { width: 100%; font-family: 'JetBrains Mono', monospace; font-size: 12px; }
  .breakdown tr { border-bottom: 1px solid var(--border); }
  .breakdown tr:last-child { border-bottom: none; }
  .breakdown td { padding: 8px 4px; }
  .breakdown .lbl { color: var(--text-dim); font-size: 11px; }
  .breakdown .val { text-align: right; font-weight: 600; }
  .breakdown .indent { padding-left: 16px; color: var(--text-muted); font-size: 11px; }
  .breakdown .total-row td { border-top: 2px solid var(--accent); font-weight: 700; font-size: 13px; padding-top: 10px; }
  .breakdown .sub-total td { border-top: 1px solid var(--border); font-weight: 600; color: var(--cyan); }

  .verdict-box { text-align: center; padding: 20px; background: var(--bg); border-radius: 10px; border: 1px solid var(--border); margin-top: 12px; }
  .verdict-box .verdict-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-dim); margin-bottom: 6px; }
  .verdict-box .verdict-value { font-family: 'JetBrains Mono', monospace; font-size: 28px; font-weight: 700; }
  .verdict-box .verdict-sub { font-size: 12px; color: var(--text-dim); margin-top: 6px; }

  .tag { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; font-family: 'JetBrains Mono', monospace; }
  .tag-green { background: var(--green-dim); color: var(--green); }
  .tag-red { background: var(--red-dim); color: var(--red); }
  .tag-amber { background: rgba(245,158,11,0.12); color: var(--amber); }

  .placeholder-msg { text-align: center; padding: 80px 20px; color: var(--text-dim); font-size: 14px; }
  .placeholder-msg .icon { font-size: 36px; margin-bottom: 12px; opacity: 0.25; }

  .flag-list { margin-top: 12px; }
  .flag-item { display: flex; align-items: flex-start; gap: 8px; padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 12px; }
  .flag-item:last-child { border-bottom: none; }
  .flag-icon { font-size: 14px; flex-shrink: 0; margin-top: 1px; }

  @media (max-width: 900px) {
    .grid-layout { grid-template-columns: 1fr; }
    .input-panel { position: static; max-height: none; }
    .metrics-grid { grid-template-columns: repeat(2, 1fr); }
    .container { padding: 16px; }
    .app-header { padding: 20px 16px; }
  }
</style>
</head>
<body>

<div class="app-header">
  <h1><span>$</span> Real Economic Profit Analyzer</h1>
  <p>Cut through accounting noise &middot; See the real cash yield</p>
</div>

<div class="container">
  <div class="grid-layout">

    <!-- INPUT PANEL -->
    <div class="input-panel">
      <div class="panel-title">10-K Data Inputs</div>

      <div class="input-group">
        <label>Company / Ticker</label>
        <input type="text" id="ticker" placeholder="e.g. AVGO">
      </div>

      <div class="input-group">
        <label>Current Share Price ($)</label>
        <input type="number" id="sharePrice" placeholder="185.00" step="0.01">
      </div>

      <div class="divider"></div>

      <!-- PHASE 1: CASH FLOW -->
      <div class="section-head">Phase 1: Cash Flow (from 10-K)</div>

      <div class="input-group">
        <label>Cash From Operations ($M)</label>
        <input type="number" id="cfo" placeholder="20,000" step="1">
      </div>

      <div class="input-row">
        <div class="input-group">
          <label>SBC Expense Addback ($M)</label>
          <input type="number" id="sbcExpense" placeholder="5,000" step="1">
          <div class="input-hint">Amount added back in CFO</div>
        </div>
        <div class="input-group">
          <label>SBC Grant Value ($M)</label>
          <input type="number" id="sbcGrant" placeholder="8,000" step="1">
          <div class="input-hint">From Notes: grant date fair value</div>
        </div>
      </div>

      <div class="input-row">
        <div class="input-group">
          <label>Total CapEx ($M)</label>
          <input type="number" id="capex" placeholder="3,500" step="1">
        </div>
        <div class="input-group">
          <label>Depreciation &amp; Amort ($M)</label>
          <input type="number" id="depreciation" placeholder="2,800" step="1">
        </div>
      </div>

      <div class="input-group">
        <label>Maint. CapEx (if disclosed) ($M)</label>
        <input type="number" id="maintCapex" placeholder="Leave blank if unknown" step="1">
        <div class="input-hint">From MD&amp;A or footnotes. If blank, app will estimate.</div>
      </div>

      <div class="input-group">
        <label>Restructuring Charges ($M)</label>
        <input type="number" id="restructuring" placeholder="0" step="1" value="0">
      </div>

      <div class="input-row">
        <div class="input-group">
          <label>Inventory Change ($M)</label>
          <input type="number" id="inventoryChange" placeholder="-500" step="1" value="0">
          <div class="input-hint">Negative = cash trapped</div>
        </div>
        <div class="input-group">
          <label>Receivables Change ($M)</label>
          <input type="number" id="receivablesChange" placeholder="-300" step="1" value="0">
          <div class="input-hint">Negative = not yet collected</div>
        </div>
      </div>

      <div class="input-row">
        <div class="input-group">
          <label>Interest Paid ($M)</label>
          <input type="number" id="interestPaid" placeholder="1,200" step="1" value="0">
        </div>
        <div class="input-group">
          <label>Income Tax Paid ($M)</label>
          <input type="number" id="taxPaid" placeholder="2,500" step="1" value="0">
        </div>
      </div>

      <div class="divider"></div>

      <!-- PHASE 2: ENTERPRISE VALUE -->
      <div class="section-head">Phase 2: Enterprise Value (from 10-K)</div>

      <div class="input-row">
        <div class="input-group">
          <label>Total Debt ($M)</label>
          <input type="number" id="totalDebt" placeholder="40,000" step="1">
        </div>
        <div class="input-group">
          <label>Cash &amp; Equivalents ($M)</label>
          <input type="number" id="cash" placeholder="10,000" step="1">
        </div>
      </div>

      <div class="input-row">
        <div class="input-group">
          <label>Short-Term Investments ($M)</label>
          <input type="number" id="shortInvestments" placeholder="2,000" step="1" value="0">
        </div>
        <div class="input-group">
          <label>Diluted Shares (M)</label>
          <input type="number" id="sharesOutstanding" placeholder="4,600" step="0.1">
        </div>
      </div>

      <div class="divider"></div>

      <button class="btn-run" onclick="analyze()">Analyze Real Profit</button>
      <button class="btn-clear" onclick="clearAll()">Clear All Fields</button>
    </div>

    <!-- RESULTS -->
    <div class="results-panel" id="resultsPanel">
      <div class="card">
        <div class="placeholder-msg">
          <div class="icon">&#9670;</div>
          <div>Enter the 10-K data and click <strong>Analyze Real Profit</strong> to expose the true economics.</div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
function getVal(id) { return parseFloat(document.getElementById(id).value) || 0; }
function fmt(n, dec) { if (dec === undefined) dec = 1; return n.toLocaleString('en-US', { minimumFractionDigits: dec, maximumFractionDigits: dec }); }
function fmtM(n) { return '$' + fmt(n, 0) + 'M'; }
function fmtB(n) { return '$' + fmt(n / 1000, 1) + 'B'; }
function fmtPct(n) { return fmt(n, 2) + '%'; }

function clearAll() {
  var inputs = document.querySelectorAll('.input-panel input');
  for (var i = 0; i < inputs.length; i++) {
    if (inputs[i].type === 'number') inputs[i].value = '';
    else if (inputs[i].type === 'text') inputs[i].value = '';
  }
  document.getElementById('resultsPanel').innerHTML = '<div class="card"><div class="placeholder-msg"><div class="icon">&#9670;</div><div>Enter the 10-K data and click <strong>Analyze Real Profit</strong> to expose the true economics.</div></div></div>';
}

function analyze() {
  var ticker = document.getElementById('ticker').value || 'COMPANY';
  var sharePrice = getVal('sharePrice');
  var cfo = getVal('cfo');
  var sbcExpense = getVal('sbcExpense');
  var sbcGrant = getVal('sbcGrant');
  var capex = getVal('capex');
  var depreciation = getVal('depreciation');
  var maintCapexInput = parseFloat(document.getElementById('maintCapex').value);
  var restructuring = getVal('restructuring');
  var inventoryChange = getVal('inventoryChange');
  var receivablesChange = getVal('receivablesChange');
  var interestPaid = getVal('interestPaid');
  var taxPaid = getVal('taxPaid');
  var totalDebt = getVal('totalDebt');
  var cash = getVal('cash');
  var shortInvestments = getVal('shortInvestments');
  var sharesOut = getVal('sharesOutstanding');

  // PHASE 3 LOGIC

  // 1. Real Maintenance CapEx
  var maintCapex;
  var maintCapexMethod;
  if (!isNaN(maintCapexInput) && maintCapexInput > 0) {
    maintCapex = maintCapexInput;
    maintCapexMethod = 'Disclosed by management';
  } else if (capex <= depreciation * 1.1) {
    maintCapex = capex;
    maintCapexMethod = 'CapEx ≈ D&A → using total CapEx';
  } else {
    maintCapex = depreciation * 1.05;
    maintCapexMethod = 'D&A + 5% inflation buffer (estimated)';
  }
  var growthCapex = capex - maintCapex;

  // 2. Real SBC Burden
  var realSBC = Math.max(sbcExpense, sbcGrant);
  var sbcMethod = sbcGrant > sbcExpense ? 'Using Grant Value (higher than expensed)' : 'Using Expensed Amount';
  var sbcDelta = sbcGrant - sbcExpense;

  // 3. Working Capital Drag
  var wcDrag = inventoryChange + receivablesChange;

  // 4. Real Economic Profit
  // Start: CFO
  // CFO already has SBC added back, so we subtract the REAL SBC
  // CFO also already includes WC changes from the CF statement
  // But we want to highlight the drag separately
  var realProfit = cfo - realSBC - maintCapex - restructuring;

  // Unlevered Real Profit (add back interest for pre-debt view)
  var unleveredProfit = realProfit + interestPaid;

  // Enterprise Value
  var marketCap = sharePrice * sharesOut;
  var totalCash = cash + shortInvestments;
  var enterpriseValue = marketCap + totalDebt - totalCash;

  // Yields
  var realYield = enterpriseValue > 0 ? (realProfit / enterpriseValue) * 100 : 0;
  var unleveredYield = enterpriseValue > 0 ? (unleveredProfit / enterpriseValue) * 100 : 0;
  var realProfitPerShare = sharesOut > 0 ? realProfit / sharesOut : 0;
  var realPE = realProfitPerShare > 0 ? sharePrice / realProfitPerShare : 0;

  // Reported FCF for comparison
  var reportedFCF = cfo - capex;
  var reportedFCFYield = enterpriseValue > 0 ? (reportedFCF / enterpriseValue) * 100 : 0;
  var fcfDelta = realProfit - reportedFCF;

  // Red Flags
  var flags = [];
  if (sbcGrant > sbcExpense * 1.5) flags.push({ icon: '&#9888;', color: 'color-red', text: 'SBC Grant Value is ' + fmt(sbcGrant / sbcExpense, 1) + 'x the expensed amount — significant hidden dilution.' });
  if (sbcGrant > 0 && realSBC / cfo > 0.25) flags.push({ icon: '&#9888;', color: 'color-red', text: 'SBC is ' + fmtPct(realSBC / cfo * 100) + ' of CFO — shareholders are funding a large portion of compensation.' });
  if (restructuring > 0 && restructuring / cfo > 0.05) flags.push({ icon: '&#9888;', color: 'color-amber', text: 'Restructuring charges are ' + fmtPct(restructuring / cfo * 100) + ' of CFO. Check if this is recurring (serial restructurer).' });
  if (wcDrag < -cfo * 0.05) flags.push({ icon: '&#9888;', color: 'color-amber', text: 'Working capital consumed ' + fmtM(Math.abs(wcDrag)) + ' — cash is trapped in inventory/receivables.' });
  if (capex > depreciation * 2) flags.push({ icon: '&#9432;', color: 'color-cyan', text: 'CapEx is ' + fmt(capex / depreciation, 1) + 'x D&A — heavy growth investment phase.' });
  if (totalDebt > 0 && totalDebt / unleveredProfit > 5) flags.push({ icon: '&#9888;', color: 'color-red', text: 'Debt is ' + fmt(totalDebt / unleveredProfit, 1) + 'x real profit — high leverage risk.' });
  if (realYield > 8) flags.push({ icon: '&#10003;', color: 'color-green', text: 'Real yield of ' + fmtPct(realYield) + ' is excellent — strong real cash generation vs price.' });
  else if (realYield > 5) flags.push({ icon: '&#10003;', color: 'color-green', text: 'Real yield of ' + fmtPct(realYield) + ' is solid.' });
  else if (realYield > 0 && realYield < 3) flags.push({ icon: '&#9888;', color: 'color-amber', text: 'Real yield of ' + fmtPct(realYield) + ' is thin — you need strong growth to justify this price.' });

  // Verdict
  var verdictText, verdictColor;
  if (realYield >= 7) { verdictText = 'STRONG VALUE'; verdictColor = 'color-green'; }
  else if (realYield >= 4) { verdictText = 'FAIR VALUE'; verdictColor = 'color-cyan'; }
  else if (realYield >= 2) { verdictText = 'GROWTH PRICED IN'; verdictColor = 'color-amber'; }
  else { verdictText = 'EXPENSIVE'; verdictColor = 'color-red'; }

  // Waterfall data
  var wfItems = [
    { label: 'CFO', value: cfo, color: 'var(--green)' },
    { label: '- Real SBC', value: -realSBC, color: 'var(--red)' },
    { label: '- Maint CapEx', value: -maintCapex, color: 'var(--red)' },
    { label: '- Restructure', value: -restructuring, color: 'var(--amber)' },
    { label: '= Real Profit', value: realProfit, color: 'var(--cyan)' }
  ];
  var wfMax = 0;
  for (var i = 0; i < wfItems.length; i++) { if (Math.abs(wfItems[i].value) > wfMax) wfMax = Math.abs(wfItems[i].value); }

  var wfHtml = '';
  for (var i = 0; i < wfItems.length; i++) {
    var w = wfItems[i];
    var h = wfMax > 0 ? Math.max(3, (Math.abs(w.value) / wfMax) * 150) : 3;
    wfHtml += '<div class="wf-col"><div class="wf-val">' + fmtM(Math.abs(w.value)) + '</div><div class="wf-bar" style="height:' + h + 'px;background:' + w.color + ';opacity:0.75;"></div><div class="wf-label">' + w.label + '</div></div>';
  }

  // Flags HTML
  var flagsHtml = '';
  for (var i = 0; i < flags.length; i++) {
    var f = flags[i];
    flagsHtml += '<div class="flag-item"><span class="flag-icon ' + f.color + '">' + f.icon + '</span><span>' + f.text + '</span></div>';
  }
  if (flags.length === 0) flagsHtml = '<div style="color:var(--text-dim);font-size:12px;padding:8px 0;">No major flags detected.</div>';

  // RENDER
  document.getElementById('resultsPanel').innerHTML =
    // VERDICT
    '<div class="card">' +
      '<div class="card-title">' + ticker.toUpperCase() + ' — Real Economic Analysis</div>' +
      '<div class="verdict-box"><div class="verdict-label">Real Cash Yield on Enterprise Value</div><div class="verdict-value ' + verdictColor + '">' + fmtPct(realYield) + '</div><div class="verdict-sub"><span class="tag tag-' + (realYield >= 4 ? 'green' : realYield >= 2 ? 'amber' : 'red') + '">' + verdictText + '</span></div></div>' +
    '</div>' +

    // KEY METRICS
    '<div class="card">' +
      '<div class="card-title">Key Metrics</div>' +
      '<div class="metrics-grid">' +
        '<div class="metric-box"><div class="label">Real Economic Profit</div><div class="value color-green">' + fmtB(realProfit) + '</div><div class="sub">' + fmtM(realProfitPerShare) + '/share</div></div>' +
        '<div class="metric-box"><div class="label">Unlevered Yield</div><div class="value color-cyan">' + fmtPct(unleveredYield) + '</div><div class="sub">Pre-debt profit</div></div>' +
        '<div class="metric-box"><div class="label">Real P/E</div><div class="value color-purple">' + (realPE > 0 ? fmt(realPE, 1) + 'x' : '—') + '</div><div class="sub">Price / Real EPS</div></div>' +
        '<div class="metric-box"><div class="label">Enterprise Value</div><div class="value color-accent">' + fmtB(enterpriseValue) + '</div><div class="sub">Mkt Cap + Debt - Cash</div></div>' +
        '<div class="metric-box"><div class="label">Reported FCF</div><div class="value color-blue">' + fmtB(reportedFCF) + '</div><div class="sub">Yield: ' + fmtPct(reportedFCFYield) + '</div></div>' +
        '<div class="metric-box"><div class="label">Real vs Reported Gap</div><div class="value ' + (fcfDelta >= 0 ? 'color-green' : 'color-red') + '">' + fmtB(fcfDelta) + '</div><div class="sub">' + (fcfDelta < 0 ? 'Reported overstates profit' : 'Reported understates profit') + '</div></div>' +
      '</div>' +
    '</div>' +

    // WATERFALL
    '<div class="card">' +
      '<div class="card-title">Profit Waterfall: CFO to Real Profit</div>' +
      '<div class="waterfall">' + wfHtml + '</div>' +
    '</div>' +

    // DETAILED BREAKDOWN
    '<div class="card">' +
      '<div class="card-title">Detailed Breakdown</div>' +
      '<table class="breakdown">' +
        '<tr><td class="lbl">Cash From Operations</td><td class="val">' + fmtM(cfo) + '</td></tr>' +
        '<tr><td class="lbl indent">SBC Expensed (in CFO)</td><td class="val" style="color:var(--text-muted)">' + fmtM(sbcExpense) + '</td></tr>' +
        '<tr><td class="lbl indent">SBC Grant Value (from Notes)</td><td class="val" style="color:var(--text-muted)">' + fmtM(sbcGrant) + '</td></tr>' +
        '<tr><td class="lbl">(-) Real SBC Burden</td><td class="val color-red">-' + fmtM(realSBC) + '</td></tr>' +
        '<tr><td class="lbl indent" style="font-size:10px">' + sbcMethod + '</td><td></td></tr>' +
        '<tr><td class="lbl">(-) Maintenance CapEx</td><td class="val color-red">-' + fmtM(maintCapex) + '</td></tr>' +
        '<tr><td class="lbl indent" style="font-size:10px">' + maintCapexMethod + '</td><td></td></tr>' +
        '<tr><td class="lbl indent">Growth CapEx (excluded)</td><td class="val" style="color:var(--text-muted)">' + fmtM(growthCapex) + '</td></tr>' +
        '<tr><td class="lbl">(-) Restructuring</td><td class="val color-amber">-' + fmtM(restructuring) + '</td></tr>' +
        '<tr class="total-row"><td class="lbl">= Real Economic Profit</td><td class="val color-green">' + fmtM(realProfit) + '</td></tr>' +
        '<tr><td colspan="2" style="padding-top:16px"></td></tr>' +
        '<tr><td class="lbl">Market Cap</td><td class="val">' + fmtB(marketCap) + '</td></tr>' +
        '<tr><td class="lbl">(+) Total Debt</td><td class="val">' + fmtB(totalDebt) + '</td></tr>' +
        '<tr><td class="lbl">(-) Cash &amp; Investments</td><td class="val">' + fmtB(totalCash) + '</td></tr>' +
        '<tr class="sub-total"><td class="lbl">= Enterprise Value</td><td class="val color-accent">' + fmtB(enterpriseValue) + '</td></tr>' +
        '<tr><td colspan="2" style="padding-top:12px"></td></tr>' +
        '<tr><td class="lbl">Interest Paid</td><td class="val">' + fmtM(interestPaid) + '</td></tr>' +
        '<tr><td class="lbl">Income Tax Paid (cash)</td><td class="val">' + fmtM(taxPaid) + '</td></tr>' +
        '<tr><td class="lbl">Working Capital Drag</td><td class="val ' + (wcDrag < 0 ? 'color-red' : 'color-green') + '">' + fmtM(wcDrag) + '</td></tr>' +
      '</table>' +
    '</div>' +

    // FLAGS
    '<div class="card">' +
      '<div class="card-title">Red Flags &amp; Signals</div>' +
      '<div class="flag-list">' + flagsHtml + '</div>' +
    '</div>';
}

document.addEventListener('keydown', function(e) { if (e.key === 'Enter') analyze(); });
</script>
</body>
</html>
